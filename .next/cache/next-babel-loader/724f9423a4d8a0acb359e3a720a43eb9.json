{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/home/vinicius/code/computers-4-all-manager/pwa/src/components/Authentication/index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport { useRouter } from 'next/router';\nimport * as Yup from 'yup';\nimport api from '../../services/api';\nimport Authentication from './Authentication';\nvar signSchema = Yup.object().shape({\n  email: Yup.string().email('Insira um e-mail válido').required('O email é obrigatório'),\n  password: Yup.string().min(6, 'A senha deve ter no mínimo 6 caracteres').required('A senha é obrigatória')\n});\n/**\n * Container responsável pela autenticação do usuário e exibição do formulário\n * de autenticação caso o usuário não esteja logado no sistema.\n *\n * @returns {React} Layout do sistema caso logado ou formulário de autenticação,\n * caso o contrário\n */\n\nfunction AuthenticationContainer() {\n  _s();\n\n  var _useState = useState(null),\n      error = _useState[0],\n      setError = _useState[1];\n\n  var router = useRouter();\n\n  var saveUser = function saveUser(token, user) {\n    localStorage.setItem('user', JSON.stringify({\n      token: token,\n      email: user.email,\n      role: user.role,\n      signed: true\n    }));\n    router.push('/');\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n      var payload, response, _response$data, token, user, _response, _response$data2, _token, _user;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              payload = {\n                email: values.email,\n                password: values.password\n              };\n\n              if (!(values.submit === 'login')) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.prev = 2;\n              _context.next = 5;\n              return api.post('/users/login', payload);\n\n            case 5:\n              response = _context.sent;\n\n              if (response.status === 200) {\n                _response$data = response.data, token = _response$data.token, user = _response$data.user;\n                saveUser(token, user);\n              }\n\n              _context.next = 12;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](2);\n\n              if (_context.t0.response) {\n                setError(_context.t0.response.data.error);\n              } else {\n                setError('Falhas ao tentar se comunicar com o servidor.');\n              }\n\n            case 12:\n              return _context.abrupt(\"return\");\n\n            case 13:\n              if (!(values.submit === 'signup')) {\n                _context.next = 25;\n                break;\n              }\n\n              _context.prev = 14;\n              _context.next = 17;\n              return api.post('/users/signup', payload);\n\n            case 17:\n              _response = _context.sent;\n\n              if (_response.status === 200) {\n                _response$data2 = _response.data, _token = _response$data2.token, _user = _response$data2.user;\n                saveUser(_token, _user);\n              }\n\n              _context.next = 24;\n              break;\n\n            case 21:\n              _context.prev = 21;\n              _context.t1 = _context[\"catch\"](14);\n\n              if (_context.t1.response) {\n                setError(_context.t1.response.statusText);\n              } else {\n                setError('Falhas ao tentar se comunicar com o servidor.');\n              }\n\n            case 24:\n              return _context.abrupt(\"return\");\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 9], [14, 21]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(Authentication, {\n    onSubmit: handleSubmit,\n    schema: signSchema,\n    errorMessage: error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 10\n    }\n  });\n}\n\n_s(AuthenticationContainer, \"MR8tCoqxvBvG3t/ali+tXhiyKHg=\", false, function () {\n  return [useRouter];\n});\n\n_c = AuthenticationContainer;\nexport default AuthenticationContainer;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthenticationContainer\");","map":{"version":3,"sources":["/home/vinicius/code/computers-4-all-manager/pwa/src/components/Authentication/index.js"],"names":["React","useState","useRouter","Yup","api","Authentication","signSchema","object","shape","email","string","required","password","min","AuthenticationContainer","error","setError","router","saveUser","token","user","localStorage","setItem","JSON","stringify","role","signed","push","handleSubmit","values","payload","submit","post","response","status","data","statusText"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { useRouter } from 'next/router';\nimport * as Yup from 'yup';\n\nimport api from '../../services/api';\n\nimport Authentication from './Authentication';\n\nconst signSchema = Yup.object().shape({\n  email: Yup.string()\n    .email('Insira um e-mail válido')\n    .required('O email é obrigatório'),\n  password: Yup.string()\n    .min(6, 'A senha deve ter no mínimo 6 caracteres')\n    .required('A senha é obrigatória')\n});\n\n/**\n * Container responsável pela autenticação do usuário e exibição do formulário\n * de autenticação caso o usuário não esteja logado no sistema.\n *\n * @returns {React} Layout do sistema caso logado ou formulário de autenticação,\n * caso o contrário\n */\nfunction AuthenticationContainer() {\n  const [error, setError] = useState(null);\n  const router = useRouter();\n\n  const saveUser = (token, user) => {\n    localStorage.setItem(\n      'user',\n      JSON.stringify({\n        token,\n        email: user.email,\n        role: user.role,\n        signed: true\n      })\n    );\n    router.push('/');\n  };\n\n  const handleSubmit = async values => {\n    const payload = {\n      email: values.email,\n      password: values.password\n    };\n\n    if (values.submit === 'login') {\n      try {\n        const response = await api.post('/users/login', payload);\n        if (response.status === 200) {\n          const { token, user } = response.data;\n          saveUser(token, user);\n        }\n      } catch (err) {\n        if (err.response) {\n          setError(err.response.data.error);\n        } else {\n          setError('Falhas ao tentar se comunicar com o servidor.');\n        }\n      }\n      return;\n    }\n    if (values.submit === 'signup') {\n      try {\n        const response = await api.post('/users/signup', payload);\n        if (response.status === 200) {\n          const { token, user } = response.data;\n          saveUser(token, user);\n        }\n      } catch (err) {\n        if (err.response) {\n          setError(err.response.statusText);\n        } else {\n          setError('Falhas ao tentar se comunicar com o servidor.');\n        }\n      }\n      return;\n    }\n  };\n\n  return <Authentication onSubmit={handleSubmit} schema={signSchema} errorMessage={error} />;\n}\n\nexport default AuthenticationContainer;\n"]},"metadata":{},"sourceType":"module"}