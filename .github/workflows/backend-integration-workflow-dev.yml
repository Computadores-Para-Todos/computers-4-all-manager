on: push
#  push:
#    branches:
#      - dev

name: Deploy to Heroku - Dev to Stagging
jobs:
  deploy_api:
    name: Deploy Api
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v1

#      - name: Build frontend
#        run: |
#          cd pwa
#          npm install
#          npm run build
#          mkdir ../api/public
#          mv build/* ../api/public

      - name: Push to Heroku remote
        id: build-image
        env:
          HEROKU_API_TOKEN: ${{ secrets.HEROKU_API_KEY }}
          HEROKU_EMAIL: ${{ secrets.HEROKU_EMAIL }}
          HEROKU_APP_NAME: "computers-4-all-staging"
        run: |
          echo "
          machine api.heroku.com
              login ${{HEROKU_EMAIL}}
              password ${{HEROKU_API_TOKEN}}
          machine git.heroku.com
              login ${{HEROKU_EMAIL}}
              password ${{HEROKU_API_TOKEN}}
          " > $HOME/.netrc
          heroku login
          heroku git:remote -a $HEROKU_APP_NAME
          git subtree push --prefix api heroku master

          #git push https://heroku:$HEROKU_API_TOKEN@git.heroku.com/$HEROKU_APP_NAME.git origin/master:master
          #git subtree push --prefix api heroku master
